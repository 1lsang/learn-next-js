# 09 Streaming
느린 데이터 요청이 있을 때 사용자 환경을 개선할 수 있는 방법

## What is streaming?
스트리밍은 경로를 더 작은 '청크'로 나누고 준비되는 대로 서버에서 클라이언트로 점진적으로 스트리밍할 수 있는 데이터 전송 기술이다. 스트리밍을 사용하면 느린 데이터 요청으로 인해 전체 페이지가 차단되는 것을 방지할 수 있다. 이를 통해 사용자는 모든 데이터가 로드될 때까지 기다리지 않고도 페이지의 일부를 보고 상호 작용할 수 있다.

React의 컴포넌트 모델에서는 각 컴포넌트를 하나의 청크로 간주할 수 있어 스트리밍이 잘 작동한다. Next.js에서 스트리밍을 구현하는 방법은 다음과 같다.
- 페이지 수준에서 `loading.tsx` 파일을 사용한다.
- 특정 컴포넌트의 경우 `<Suspense>`를 사용한다.

## Streaming a whole page with `loading.tsx`
`loading.tsx`는 Suspense 최상단에 구축된 특별한 Next.js 파일으로 페이지 콘텐츠가 로드되는 동안의 fallback UI를 만들 수 있다. `<Sidebar>`를 정적으로 구현하고 로딩파일을 설정한다면 사용자는 페이지 로딩이 완료되지 않아도 다른 페이지로 이동(interruptable navigation 가능)할 수 있다.

## Fixing the loading skeleton bug with route groups
`loading.tsx`를 설정하면 파일 시스템상 하위 페이지들에도 모두 로딩이 적용된다. 이는 route 그룹을 사용해서 변경할 수 있다. 괄호`()`를 사용하여 새 폴더를 만들면 URL 경로에 폴더 이름이 포함되지 않는다. route 그룹은 어플리케이션을 섹션이나 팀별로 분리하는 데에도 사용할 수 있다.

## Streaming a component
React Suspense를 사용하면 더 세분화하여 특정 컴포넌트를 스트리밍할 수 있다. 동적 컴포넌트를 Suspense로 래핑하고 동적 컴포넌트가 로드되는 동안 표시한 fallback 컴포넌트를 전달하면 된다.

## Grouping components
카드와 같은 컴포넌트에서 개별로 데이터를 받아오는 형태로 만들 수 있지만, 카드가 로드될 때 하나씩 로드되는 것이 사용자에게 시각적으로 어색할 수 있다. 따라서 래퍼 컴포넌트를 사용하여 그룹화하여 나타낼 수 있다.

## Deciding where to place your Suspense boundaries
Suspense 경계를 어디에 배치할지는 다음과 같은 요소에 따라 결정된다.
1. 사용자가 페이지가 스트리밍되는 동안 어떤 경험을 하길 원하는지
2. 우선순위가 있는 콘텐츠가 있는지
3. 컴포넌트가 데이터 패칭에 의존하는지

- `loading.tsx`를 통해 **전체 페이지**를 스트리밍할 수 있지만 구성 요소 중 하나가 유독 느린 경우 로딩시간이 더 길어질 수 있다.
- **모든 컴포넌트를 개별적으로** 스트리밍할 수 있지만 시간이 지나면서 화면에 UI가 각각 튀어나올 수 있다.
- **페이지 섹션**을 만들어 스트리밍하여 시차를 두는 효과를 만들 수도 있지만 wrapper 컴포넌트가 필요하다.
  이처럼 Suspense의 경계는 어플리케이션에 따라 달라질 수 있다.

스트리밍과 서버 컴포넌트는 최종 사용자 경험을 개선하는 것을 목표로 데이터 불러오기 및 로드 상태를 처리하는 새로운 방법을 제공한다.
