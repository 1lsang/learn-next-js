
# 11 Adding Search and Pagination
검색 기능은 클라이언트와 서버에 걸쳐 작동한다. 사용자가 클라이언트에서 인보이스를 검색하면 URL 파라미터가 업데이트되고, 서버에서 데이터를 가져와 새 데이터가 포함된 테이블이 서버에서 다시 렌더링된다.

## Why use URL search params?
클라이언트단의 상태를 사용하는 데 익숙하다면 URL 파라미터를 사용하는 패턴이 생소할 수 있다. URL 파라미터로 검색을 구현하면 몇가지 이점이 있다.
- 북마크 및 공유 가능한 URL: 검색 매개변수가 URL에 있어 사용자는 검색 쿼리, 필터 등 어플리케이션의 현재 상태를 북마크에 추가하여 나중에 참조하거나 공유할 수 있다.
- 서버 사이드 렌더링과 초기 로드: URL 매개변수를 서버에서 직접 사용하여 초기 상태를 렌더링할 수 있으므로 서버 렌더링을 더 쉽게 처리할 수 있다.
- 분석 및 추적: 검색 쿼리와 필터를 URL에 직접 넣으면 추가적인 클라이언트 측 로직 없이도 사용자 행동을 더 쉽게 추적할 수 있다.

## Adding the search functionality
검색 기능 구현을 위해 필요한 hook은 다음과 같다.
- `useSearchParams` - 현재 URL의 매개변수에 액세스할 수 있는 Hook.
- `usePathname` - 현재 URL의 경로 이름을 읽을 수 있는 Hook.
- `useRouter` - 클라이언트 구성 요소 내에서 프로그래밍 방식으로 경로 간 탐색을 활성화하는 Hook.

구현 단계는 다음과 같다.
1. 이벤트 핸들러를 연결하여 입력을 받는다.
2. 검색 매개변수로 URL을 업데이트합니다.
3. URL을 입력 필드와 동기화 상태로 유지합니다. `defaultValue` 사용
4. 검색 쿼리를 반영하도록 테이블을 업데이트합니다.

> **`defaultValue` vs. `value` / Controlled vs. Uncontrolled**
> state를 사용하여 입력의 값을 관리하는 경우, value 속성을 사용하여 제어되는 컴포넌트로 만들 수 있다. 이는 React가 입력의 상태를 관리한다는 것을 의미한다.
> 하지만 state를 사용하지 않는다면 defaultValue를 사용할 수 있다. 이는 네이티브 입력이 자체 상태를 관리한다는 뜻이다. 상태 대신 URL에 검색 쿼리를 저장하기 때문에 괜찮다.

> **`useSearchParams()` hook vs. `searchParams` prop**
> 일반적으로 클라이언트에서 URL 파라미터를 읽으려면 `useSearchParams()` 훅을 사용하고, 서버 컴포넌트에서는 searchParams 프로퍼티를 사용하면 된다.

### Best practice: Debouncing
검색 최적화를 위해서 디바운싱을 사용하는 것이 좋다. 모든 키 입력에 대해 URL을 업데이트하고 모든 키 입력에 대해 데이터베이스를 쿼리하고 있다. 어플리케이션의 규모가 작으면 문제가 되지 않지만 수천 명의 사용자가 있고 각 사용자가 키 입력 시마다 데이터베이스에 새 요청을 보낸다면 매우 비용이 커진다.

디바운싱은 함수가 실행될 수 있는 속도를 제한하는 프로그래밍 기법이다. 예를 들어, 사용자가 입력을 중단했을 때만 데이터베이스를 쿼리하도록 하는 것이다.

디바운싱은 다음과 같이 작동한다.
- 이벤트 트리거: 검색창의 키 입력과 같이 디바운스해야 하는 이벤트가 발생하면 타이머가 시작된다.
- 대기: 타이머가 만료되기 전에 새 이벤트가 발생하면 타이머가 재설정된다.
- 실행: 타이머가 카운트다운 종료에 도달하면 디바운스 함수가 실행된다.

## Adding pagination
Search 기능을 만든 것과 같이 `pathname`과 `URL Search Parameter`를 활용하여 페이지네이션을 구현한다.
1. API로 검색 쿼리를 기준으로 총 페이지 수를 받아와 `<Pagination />` 컴포넌트의 props로 전달한다.
2. `<Pagination />` 컴포넌트 내부에서 페이지에 따라서 `SearchParams`을 기반으로 URL을 만들어 이동할 수 있도록 설정한다.
